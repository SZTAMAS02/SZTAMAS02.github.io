<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1 2025 Vizualizáció</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/topojson-client@3"></script>
</head>
<body class="min-h-screen p-6" style="background-image: url('https://www.f1-fansite.com/wp-content/uploads/2025/03/2025-Australian-Grand-Prix-Sunday-12-Aangepast.webp'); background-size: cover; background-position: center; background-attachment: fixed;">

<div class="max-w-7xl mx-auto">

  <!-- HEADER -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8" style="background-color: rgba(255, 255, 255, 0.85);">
    <h1 class="text-5xl font-bold text-gray-800 mb-3">F1 2025 Vizualizáció</h1>
    <p class="text-2xl text-gray-600 mb-4">Pont trendek, összpontok és versenyhelyszínek</p>
  </div>

  <!-- LINE CHART: TOP 3 PILÓTA -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8" style="background-color: rgba(255, 255, 255, 0.85);">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Top 3 pilóta kumulatív pont trend</h2>
    <canvas id="pointsChart" height="120"></canvas>
  </div>

  <!-- BAR CHART: ÖSSZPONTOK -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8" style="background-color: rgba(255, 255, 255, 0.85);">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Szezon végi összpontszámok - Pilóták</h2>
    <canvas id="barChart" height="120"></canvas>
  </div>

  <!-- BAR CHART: KONSTRUKTŐRÖK -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8" style="background-color: rgba(255, 255, 255, 0.85);">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Szezon végi összpontszámok - Konstruktőrök</h2>
    <canvas id="constructorChart" height="100"></canvas>
  </div>

  <!-- TÉRKÉP: Versenyhelyszínek -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8" style="background-color: rgba(255, 255, 255, 0.85);">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Versenyhelyszínek világtérképen</h2>
    <div id="mapContainer" style="width: 100%; height: 600px; position: relative;">
      <svg id="worldMap" width="100%" height="100%"></svg>
    </div>
  </div>

</div>

<script>
const teamColors = {
  "McLaren": "#FF8700",
  "Red Bull Racing": "#0033A0",
  "Ferrari": "#DC0000",
  "Mercedes": "#00D2BE",
  "Williams": "#005AFF",
  "Aston Martin": "#006F62",
  "Kick Sauber": "#00FF00",
  "Racing Bulls": "#6699FF",
  "Haas F1 Team": "#B6BABD",
  "Haas": "#B6BABD",
  "Alpine": "#0090FF"
};

// CSV betöltése és feldolgozása
async function loadData() {
  try {
    const response = await fetch('data.csv');
    const csvText = await response.text();
    
    // CSV feldolgozása
    const lines = csvText.trim().split('\n');
    const raceData = {};
    const driverPoints = {};
    const driverTeams = {};
    
    lines.forEach(line => {
      const [race, position, driver, team, points] = line.split(',');
      
      // Verseny adatok tárolása
      if (!raceData[race]) {
        raceData[race] = [];
      }
      raceData[race].push({ driver, team, points: parseInt(points) });
      
      // Pilóta pontjainak és csapatának tárolása
      if (!driverPoints[driver]) {
        driverPoints[driver] = [];
        driverTeams[driver] = team;
      }
    });
    
    // Verseny sorrend meghatározása
    const races = Object.keys(raceData);
    
    // Minden pilóta pontjainak összegyűjtése versenyek szerint
    const allDrivers = Object.keys(driverPoints);
    allDrivers.forEach(driver => {
      races.forEach(race => {
        const raceResult = raceData[race].find(r => r.driver === driver);
        driverPoints[driver].push(raceResult ? raceResult.points : 0);
      });
    });
    
    // Összpontok számítása
    const totalPoints = {};
    allDrivers.forEach(driver => {
      totalPoints[driver] = driverPoints[driver].reduce((sum, points) => sum + points, 0);
    });
    
    // Top 3 pilóta kiválasztása
    const top3Drivers = allDrivers
      .sort((a, b) => totalPoints[b] - totalPoints[a])
      .slice(0, 3);
    
    // Kumulatív pontok számítása a top 3-nak
    const cumulativePoints = {};
    top3Drivers.forEach(driver => {
      cumulativePoints[driver] = [];
      let sum = 0;
      driverPoints[driver].forEach(points => {
        sum += points;
        cumulativePoints[driver].push(sum);
      });
    });
    
    // --- ELSŐ DIAGRAM: Kumulatív pontok ---
    const datasets = top3Drivers.map(driver => ({
      label: driver,
      data: cumulativePoints[driver],
      borderColor: teamColors[driverTeams[driver]],
      backgroundColor: teamColors[driverTeams[driver]] + "55",
      fill: true,
      tension: 0.3,
      borderWidth: 3
    }));
    
    new Chart(document.getElementById('pointsChart'), {
      type: 'line',
      data: { labels: races, datasets: datasets },
      options: {
        responsive: true,
        plugins: {
          tooltip: { mode: 'index', intersect: false },
          legend: { position: 'top', labels: { font: { size: 16 } } }
        },
        interaction: { mode: 'nearest', axis: 'x', intersect: false },
        scales: { 
          y: { 
            title: { display: true, text: 'Kumulatív pontok' }, 
            beginAtZero: true, 
            max: 450 
          } 
        }
      }
    });
    
    // --- MÁSODIK DIAGRAM: Összpontok ---
    const sortedDrivers = allDrivers.sort((a, b) => totalPoints[b] - totalPoints[a]);
    
    new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: {
        labels: sortedDrivers,
        datasets: [{
          label: 'Összpont',
          data: sortedDrivers.map(d => totalPoints[d]),
          backgroundColor: sortedDrivers.map(d => teamColors[driverTeams[d]])
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: { enabled: true }
        },
        scales: { y: { beginAtZero: true, title: { display: true, text: 'Pont' } } }
      }
    });
    
    // --- KONSTRUKTŐR DIAGRAM ---
    const constructorPoints = {};
    allDrivers.forEach(driver => {
      const team = driverTeams[driver];
      if (!constructorPoints[team]) {
        constructorPoints[team] = 0;
      }
      constructorPoints[team] += totalPoints[driver];
    });
    
    const sortedTeams = Object.keys(constructorPoints).sort((a, b) => constructorPoints[b] - constructorPoints[a]);
    
    new Chart(document.getElementById('constructorChart'), {
      type: 'bar',
      data: {
        labels: sortedTeams,
        datasets: [{
          label: 'Konstruktőr pontok',
          data: sortedTeams.map(team => constructorPoints[team]),
          backgroundColor: sortedTeams.map(team => teamColors[team])
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: { enabled: true }
        },
        scales: { y: { beginAtZero: true, title: { display: true, text: 'Pont' } } }
      }
    });
    
    // --- HARMADIK DIAGRAM: Világtérkép ---
    const raceLocations = {
      'Australia': { coords: [133.88, -25.27], city: 'Melbourne' },
      'China': { coords: [121.47, 31.23], city: 'Shanghai' },
      'Japan': { coords: [136.53, 34.84], city: 'Suzuka' },
      'Bahrain': { coords: [50.51, 26.03], city: 'Sakhir' },
      'Saudi Arabia': { coords: [39.10, 21.63], city: 'Jeddah' },
      'Miami': { coords: [-80.24, 25.96], city: 'Miami' },
      'Emilia Romagna': { coords: [11.71, 44.34], city: 'Imola' },
      'Monaco': { coords: [7.42, 43.73], city: 'Monte Carlo' },
      'Spain': { coords: [2.26, 41.57], city: 'Barcelona' },
      'Canada': { coords: [-73.52, 45.50], city: 'Montreal' },
      'Austria': { coords: [14.76, 47.22], city: 'Spielberg' },
      'Great Britain': { coords: [-1.02, 52.07], city: 'Silverstone' },
      'Belgium': { coords: [5.97, 50.44], city: 'Spa-Francorchamps' },
      'Hungary': { coords: [19.25, 47.58], city: 'Budapest' },
      'Netherlands': { coords: [4.54, 52.39], city: 'Zandvoort' },
      'Italy': { coords: [9.29, 45.62], city: 'Monza' },
      'Azerbaijan': { coords: [49.85, 40.37], city: 'Baku' },
      'Singapore': { coords: [103.86, 1.29], city: 'Marina Bay' },
      'United States': { coords: [-97.64, 30.13], city: 'Austin' },
      'Mexico': { coords: [-99.09, 19.40], city: 'Mexico City' },
      'Brazil': { coords: [-46.70, -23.70], city: 'São Paulo' },
      'Las Vegas': { coords: [-115.17, 36.11], city: 'Las Vegas' },
      'Qatar': { coords: [51.45, 25.49], city: 'Lusail' },
      'Abu Dhabi': { coords: [54.60, 24.47], city: 'Yas Island' }
    };

    const raceWinners = {};
    races.forEach(race => {
      const raceName = race.replace(' Sprint', '');
      if (!raceWinners[raceName]) {
        const winner = raceData[race].find(r => parseInt(r.points) === 25 || parseInt(r.points) === 8);
        if (winner) {
          raceWinners[raceName] = winner.driver;
        }
      }
    });

    // D3.js világtérkép létrehozása
    const width = document.getElementById('mapContainer').offsetWidth;
    const height = 600;

    const svg = d3.select('#worldMap')
      .attr('width', width)
      .attr('height', height);

    const projection = d3.geoMercator()
      .scale(width / 6.5)
      .translate([width / 2, height / 1.5]);

    const path = d3.geoPath().projection(projection);

    // Világtérkép betöltése
    d3.json('https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json').then(world => {
      const countries = topojson.feature(world, world.objects.countries);

      // Országok rajzolása
      svg.append('g')
        .selectAll('path')
        .data(countries.features)
        .enter()
        .append('path')
        .attr('d', path)
        .attr('fill', '#e0e0e0')
        .attr('stroke', '#ffffff')
        .attr('stroke-width', 0.5);

      // Versenyhelyszínek pontjai
      Object.keys(raceLocations).forEach(race => {
        if (raceWinners[race]) {
          const location = raceLocations[race];
          const coords = projection(location.coords);

          // Pont
          const circle = svg.append('circle')
            .attr('cx', coords[0])
            .attr('cy', coords[1])
            .attr('r', 8)
            .attr('fill', '#DC0000')
            .attr('stroke', '#ffffff')
            .attr('stroke-width', 2)
            .style('cursor', 'pointer')
            .on('mouseover', function(event) {
              d3.select(this)
                .transition()
                .duration(200)
                .attr('r', 12);
              
              tooltip.style('opacity', 1)
                .html(`<strong>${race}</strong><br/>${location.city}<br/>Győztes: ${raceWinners[race]}`)
                .style('left', (event.pageX + 10) + 'px')
                .style('top', (event.pageY - 10) + 'px');
            })
            .on('mouseout', function() {
              d3.select(this)
                .transition()
                .duration(200)
                .attr('r', 8);
              
              tooltip.style('opacity', 0);
            });
        }
      });

      // Tooltip létrehozása
      const tooltip = d3.select('body')
        .append('div')
        .style('position', 'absolute')
        .style('background', 'rgba(0, 0, 0, 0.8)')
        .style('color', 'white')
        .style('padding', '10px 15px')
        .style('border-radius', '8px')
        .style('font-size', '14px')
        .style('pointer-events', 'none')
        .style('opacity', 0)
        .style('transition', 'opacity 0.2s')
        .style('z-index', '1000');
    });
    
  } catch (error) {
    console.error('Hiba a CSV betöltése során:', error);
  }
}

// Adatok betöltése az oldal betöltésekor
loadData();
</script>
</body>
</html>

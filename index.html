<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>F1 2023 – Szezon Elemzés</title>

<script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
<script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

<style>
body {
  background: #000;
  color: white;
  font-family: Arial, sans-serif;
}
.card {
  background: white;
  color: black;
  padding: 20px;
  margin-bottom: 30px;
  border-radius: 12px;
}
</style>
</head>

<body>

<h1>Formula 1 2023 – F1 Fan Elemzés</h1>

<div class="card">
  <h2>Z-score – összpontszám</h2>
  <div id="zscore"></div>
</div>

<div class="card">
  <h2>Dobogós helyezések száma</h2>
  <div id="podiums"></div>
</div>

<div class="card">
  <h2>Átlagos célba érési helyezés</h2>
  <div id="avgpos"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

const data = [
  {Race:"Bahrain",Driver:"Verstappen",Points:25,Position:1},
  {Race:"Bahrain",Driver:"Perez",Points:18,Position:2},
  {Race:"Bahrain",Driver:"Alonso",Points:15,Position:3},

  {Race:"Saudi Arabia",Driver:"Verstappen",Points:25,Position:1},
  {Race:"Saudi Arabia",Driver:"Perez",Points:18,Position:2},
  {Race:"Saudi Arabia",Driver:"Alonso",Points:15,Position:3},

  {Race:"Australia",Driver:"Verstappen",Points:25,Position:1},
  {Race:"Australia",Driver:"Hamilton",Points:18,Position:2},
  {Race:"Australia",Driver:"Alonso",Points:15,Position:3},

  {Race:"Monaco",Driver:"Verstappen",Points:25,Position:1},
  {Race:"Monaco",Driver:"Alonso",Points:18,Position:2},
  {Race:"Monaco",Driver:"Ocon",Points:15,Position:3}
];

// ---------- Z-SCORE ----------
vegaEmbed("#zscore", {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 300,
  "data":{"values":data},
  "transform":[
    {"aggregate":[{"op":"sum","field":"Points","as":"Total"}],"groupby":["Driver"]},
    {"joinaggregate":[
      {"op":"mean","field":"Total","as":"meanP"},
      {"op":"stdev","field":"Total","as":"stdP"}
    ]},
    {"calculate":"(datum.Total-datum.meanP)/datum.stdP","as":"Z"}
  ],
  "mark":"bar",
  "encoding":{
    "x":{"field":"Driver","type":"nominal","sort":"-y"},
    "y":{"field":"Z","type":"quantitative","title":"Z-score"},
    "color":{"field":"Z","type":"quantitative","scale":{"scheme":"redblue","domainMid":0}}
  }
},{actions:false});

// ---------- PODIUMS ----------
vegaEmbed("#podiums", {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 300,
  "data":{"values":data},
  "transform":[{"filter":"datum.Position <= 3"}],
  "mark":"bar",
  "encoding":{
    "x":{"field":"Driver","type":"nominal"},
    "y":{"aggregate":"count","title":"Dobogók száma"},
    "color":{"field":"Driver","type":"nominal"}
  }
},{actions:false});

// ---------- AVG POSITION ----------
vegaEmbed("#avgpos", {
  "$schema":"https://vega.github.io/schema/vega-lite/v5.json",
  "width": 600,
  "height": 300,
  "data":{"values":data},
  "transform":[
    {"aggregate":[{"op":"mean","field":"Position","as":"AvgPos"}],"groupby":["Driver"]}
  ],
  "mark":"bar",
  "encoding":{
    "x":{"field":"Driver","type":"nominal","sort":"y"},
    "y":{"field":"AvgPos","title":"Átlagos helyezés"},
    "color":{"field":"AvgPos","type":"quantitative","scale":{"scheme":"reds"}}
  }
},{actions:false});

});
</script>

</body>
</html>

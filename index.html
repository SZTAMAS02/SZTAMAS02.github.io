<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1 2025 Vizualizáció</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-chart-geo@3.6.0"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 min-h-screen p-6">

<div class="max-w-7xl mx-auto">

  <!-- HEADER -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
    <h1 class="text-5xl font-bold text-gray-800 mb-3">F1 2025 Vizualizáció</h1>
    <p class="text-2xl text-gray-600 mb-4">Pont trendek, összpontok és versenyhelyszínek</p>
  </div>

  <!-- LINE CHART: TOP 3 PILÓTA -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Top 3 pilóta kumulatív pont trend</h2>
    <canvas id="pointsChart" height="120"></canvas>
  </div>

  <!-- BAR CHART: ÖSSZPONTOK -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Szezon végi összpontszámok</h2>
    <canvas id="barChart" height="120"></canvas>
  </div>

  <!-- TÉRKÉP: Versenyhelyszínek -->
  <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8">
    <h2 class="text-3xl font-bold text-gray-800 mb-6">Versenyhelyszínek</h2>
    <canvas id="mapChart" height="400"></canvas>
  </div>

</div>

<script>
const teamColors = {
  "McLaren": "#FF8700",
  "Red Bull Racing": "#0033A0",
  "Ferrari": "#DC0000",
  "Mercedes": "#00D2BE",
  "Williams": "#005AFF",
  "Aston Martin": "#006F62",
  "Kick Sauber": "#FFD700",
  "Racing Bulls": "#6699FF",
  "Haas F1 Team": "#B6BABD",
  "Haas": "#B6BABD",
  "Alpine": "#0090FF"
};

// CSV betöltése és feldolgozása
async function loadData() {
  try {
    const response = await fetch('data.csv');
    const csvText = await response.text();
    
    // CSV feldolgozása
    const lines = csvText.trim().split('\n');
    const raceData = {};
    const driverPoints = {};
    const driverTeams = {};
    
    lines.forEach(line => {
      const [race, position, driver, team, points] = line.split(',');
      
      // Verseny adatok tárolása
      if (!raceData[race]) {
        raceData[race] = [];
      }
      raceData[race].push({ driver, team, points: parseInt(points) });
      
      // Pilóta pontjainak és csapatának tárolása
      if (!driverPoints[driver]) {
        driverPoints[driver] = [];
        driverTeams[driver] = team;
      }
    });
    
    // Verseny sorrend meghatározása
    const races = Object.keys(raceData);
    
    // Minden pilóta pontjainak összegyűjtése versenyek szerint
    const allDrivers = Object.keys(driverPoints);
    allDrivers.forEach(driver => {
      races.forEach(race => {
        const raceResult = raceData[race].find(r => r.driver === driver);
        driverPoints[driver].push(raceResult ? raceResult.points : 0);
      });
    });
    
    // Összpontok számítása
    const totalPoints = {};
    allDrivers.forEach(driver => {
      totalPoints[driver] = driverPoints[driver].reduce((sum, points) => sum + points, 0);
    });
    
    // Top 3 pilóta kiválasztása
    const top3Drivers = allDrivers
      .sort((a, b) => totalPoints[b] - totalPoints[a])
      .slice(0, 3);
    
    // Kumulatív pontok számítása a top 3-nak
    const cumulativePoints = {};
    top3Drivers.forEach(driver => {
      cumulativePoints[driver] = [];
      let sum = 0;
      driverPoints[driver].forEach(points => {
        sum += points;
        cumulativePoints[driver].push(sum);
      });
    });
    
    // --- ELSŐ DIAGRAM: Kumulatív pontok ---
    const datasets = top3Drivers.map(driver => ({
      label: driver,
      data: cumulativePoints[driver],
      borderColor: teamColors[driverTeams[driver]],
      backgroundColor: teamColors[driverTeams[driver]] + "55",
      fill: true,
      tension: 0.3,
      borderWidth: 3
    }));
    
    new Chart(document.getElementById('pointsChart'), {
      type: 'line',
      data: { labels: races, datasets: datasets },
      options: {
        responsive: true,
        plugins: {
          tooltip: { mode: 'index', intersect: false },
          legend: { position: 'top', labels: { font: { size: 16 } } }
        },
        interaction: { mode: 'nearest', axis: 'x', intersect: false },
        scales: { 
          y: { 
            title: { display: true, text: 'Kumulatív pontok' }, 
            beginAtZero: true, 
            max: 450 
          } 
        }
      }
    });
    
    // --- MÁSODIK DIAGRAM: Összpontok ---
    const sortedDrivers = allDrivers.sort((a, b) => totalPoints[b] - totalPoints[a]);
    
    new Chart(document.getElementById('barChart'), {
      type: 'bar',
      data: {
        labels: sortedDrivers,
        datasets: [{
          label: 'Összpont',
          data: sortedDrivers.map(d => totalPoints[d]),
          backgroundColor: sortedDrivers.map(d => teamColors[driverTeams[d]])
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false },
          tooltip: { enabled: true }
        },
        scales: { y: { beginAtZero: true, title: { display: true, text: 'Pont' } } }
      }
    });
    
    // --- HARMADIK DIAGRAM: Térkép ---
    const raceWinners = {};
    races.forEach(race => {
      const winner = raceData[race].find(r => parseInt(r.points) === 25);
      if (winner) {
        raceWinners[race] = winner.driver;
      }
    });
    
    const mapData = {
      type: 'FeatureCollection',
      features: [
        {type:'Feature',properties:{race:'Australia',winner:raceWinners['Australia']},geometry:{type:'Point',coordinates:[133.88,-25.27]}},
        {type:'Feature',properties:{race:'China',winner:raceWinners['China']},geometry:{type:'Point',coordinates:[116.38,39.90]}},
        {type:'Feature',properties:{race:'Japan',winner:raceWinners['Japan']},geometry:{type:'Point',coordinates:[139.69,35.69]}},
        {type:'Feature',properties:{race:'Bahrain',winner:raceWinners['Bahrain']},geometry:{type:'Point',coordinates:[50.55,26.03]}},
        {type:'Feature',properties:{race:'Saudi Arabia',winner:raceWinners['Saudi Arabia']},geometry:{type:'Point',coordinates:[39.57,21.61]}},
        {type:'Feature',properties:{race:'Miami',winner:raceWinners['Miami']},geometry:{type:'Point',coordinates:[-80.19,25.76]}}
      ]
    };
    
    const ctx = document.getElementById('mapChart').getContext('2d');
    new Chart(ctx, {
      type: 'bubbleMap',
      data: {
        labels: mapData.features.map(f => f.properties.race),
        datasets: [{
          label: 'Versenyhelyszínek',
          data: mapData.features.map(f => ({
            x: f.geometry.coordinates[0],
            y: f.geometry.coordinates[1],
            r: 8,
            winner: f.properties.winner
          })),
          backgroundColor: '#FF0000'
        }]
      },
      options: {
        plugins: {
          tooltip: {
            callbacks: {
              label: function(context) {
                return context.raw.winner + " nyerte a " + context.label + " futamot";
              }
            }
          },
          legend: { display: false }
        },
        scales: {
          x: { type: 'linear', title: { display: true, text: 'Longitude' } },
          y: { type: 'linear', title: { display: true, text: 'Latitude' } }
        }
      }
    });
    
  } catch (error) {
    console.error('Hiba a CSV betöltése során:', error);
  }
}

// Adatok betöltése az oldal betöltésekor
loadData();
</script>
</body>
</html>

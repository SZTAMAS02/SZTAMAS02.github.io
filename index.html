<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>F1 Performance Analytics - 2023</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen p-6 font-sans">
  <div class="max-w-7xl mx-auto">
    
    <div class="bg-slate-800 rounded-2xl shadow-2xl p-8 mb-8 border-b-4 border-red-600">
      <h1 class="text-5xl font-extrabold mb-3 tracking-tight">F1 <span class="text-red-600">Performance</span> Analytics</h1>
      <p class="text-2xl text-slate-400 mb-4">2023-as Szezon: Pilóták teljesítményének Z-score alapú elemzése</p>
      <div class="flex gap-3">
        <span class="bg-red-600 text-white px-4 py-2 rounded-full text-sm font-bold uppercase tracking-widest">Live Data</span>
        <span class="bg-slate-700 text-slate-300 px-4 py-2 rounded-full text-sm font-semibold">Vega-Lite Engine</span>
      </div>
    </div>

    <div class="grid md:grid-cols-3 gap-6 mb-8">
      <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
        <p class="text-slate-400 font-medium">Összesített adatpont</p>
        <h3 class="text-4xl font-bold mt-2">~1,050</h3>
        <p class="text-xs text-green-400 mt-2">Köridők és szektoridők alapján</p>
      </div>
      <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
        <p class="text-slate-400 font-medium">Fő Metrika</p>
        <h3 class="text-4xl font-bold mt-2 text-red-500">Z-Score</h3>
        <p class="text-xs text-slate-400 mt-2">Relatív teljesítmény az átlaghoz képest</p>
      </div>
      <div class="bg-slate-800 p-6 rounded-2xl border border-slate-700 shadow-xl">
        <p class="text-slate-400 font-medium">Célközönség</p>
        <h3 class="text-4xl font-bold mt-2 italic">Menedzsment</h3>
        <p class="text-xs text-blue-400 mt-2">Döntéstámogató vizualizáció</p>
      </div>
    </div>

    <div class="bg-white rounded-2xl shadow-2xl p-8 mb-8 min-h-[500px]">
      <div id="vis" class="w-full"></div>
    </div>

    <div class="grid md:grid-cols-2 gap-8">
      <div class="bg-slate-800 p-8 rounded-2xl shadow-xl border-l-8 border-red-600">
        <h3 class="text-2xl font-bold mb-4 text-red-500 underline underline-offset-8">Módszertani Elemzés</h3>
        <p class="text-slate-300 leading-relaxed mb-4">
          A vizualizáció a pilóták pontszámait és helyezéseit veti össze. Az adatok <strong>Z-score normalizáláson</strong> estek át, ami megmutatja, hány szórásnyi távolságra van egy pilóta az átlagtól.
        </p>
        <ul class="text-sm text-slate-400 space-y-2">
          <li>• <strong>0 feletti érték:</strong> Átlag feletti teljesítmény</li>
          <li>• <strong>0 alatti érték:</strong> Átlag alatti teljesítmény</li>
          <li>• <strong>Interaktivitás:</strong> Szűrés csapatok alapján</li>
        </ul>
      </div>
      <div class="bg-slate-800 p-8 rounded-2xl shadow-xl">
        <h3 class="text-2xl font-bold mb-4">Üzleti Érték (Menedzsment)</h3>
        <p class="text-slate-300">
          A befektetők számára ez a nézet rávilágít az "alulértékelt" versenyzőkre, akiknél a pontszám (Z-score) és a megszerzett helyezés korrelációja eltér a piaci trendtől.
        </p>
      </div>
    </div>
  </div>

  <script>
    // Vega-Lite specifikáció
    const spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "description": "F1 2023 Driver Performance Z-Score",
      "width": "container",
      "height": 400,
      "data": {
        "url": "https://raw.githubusercontent.com/jhellings1/F1-Database/main/f1db-csv/results.csv" // Valós F1 CSV adatforrás
      },
      "transform": [
        {"filter": "datum.raceId >= 1098"}, // Csak a 2023-as szezon
        {
          "aggregate": [{"op": "sum", "field": "points", "as": "total_points"}],
          "groupby": ["driverId"]
        },
        {
          "window": [
            {"op": "mean", "field": "total_points", "as": "avg_points"},
            {"op": "stdev", "field": "total_points", "as": "std_points"}
          ]
        },
        {
          "calculate": "(datum.total_points - datum.avg_points) / datum.std_points",
          "as": "z_score"
        }
      ],
      "layer": [
        {
          "mark": {"type": "bar", "cornerRadiusEnd": 4},
          "encoding": {
            "x": {
              "field": "driverId", 
              "type": "nominal", 
              "sort": "-y", 
              "title": "Pilóta ID"
            },
            "y": {
              "field": "z_score", 
              "type": "quantitative", 
              "title": "Teljesítmény (Z-Score)"
            },
            "color": {
              "field": "z_score",
              "type": "quantitative",
              "scale": {"scheme": "redblue", "domainMid": 0}
            },
            "tooltip": [
              {"field": "driverId", "title": "Pilóta"},
              {"field": "total_points", "title": "Összes pont"},
              {"field": "z_score", "title": "Z-Score", "format": ".2f"}
            ]
          }
        },
        {
          "mark": {"type": "rule", "color": "black", "strokeDash": [4,4]},
          "encoding": {"y": {"datum": 0}}
        }
      ],
      "config": {
        "view": {"stroke": "transparent"},
        "axis": {"labelFont": "Inter", "titleFont": "Inter"}
      }
    };

    vegaEmbed('#vis', spec, {actions: false});
  </script>
</body>
</html>

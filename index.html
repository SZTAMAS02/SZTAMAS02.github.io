<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <title>F1 2025 Performance Tracker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
</head>
<body class="bg-[#0b0e14] text-white font-sans p-4">

  <div class="max-w-6xl mx-auto">
    <header class="mb-10 p-8 bg-gradient-to-r from-red-900/40 to-slate-900 rounded-3xl border border-red-500/30">
      <div class="flex justify-between items-center">
        <div>
          <h1 class="text-5xl font-black italic tracking-tighter uppercase">F1 <span class="text-red-600">2025</span></h1>
          <p class="text-slate-400 font-light text-lg mt-1 underline decoration-red-600/50">Szezonközi Z-Score Teljesítmény Analitika</p>
        </div>
        <div class="hidden md:block text-right text-xs font-mono text-slate-500">
          STATUS: LIVE DATA STREAM<br>SOURCE: DATA.CSV
        </div>
      </div>
    </header>

    <main class="bg-white rounded-3xl p-6 shadow-[0_0_50px_rgba(220,38,38,0.15)] overflow-hidden">
      <div id="vis" class="w-full"></div>
    </main>

    <section class="mt-10 grid md:grid-cols-3 gap-6">
      <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
        <h3 class="text-red-500 font-bold mb-2 uppercase text-sm italic">Adatstruktúra</h3>
        <p class="text-slate-400 text-xs">Sor alapú (Tidy) formátum. A <code>data.csv</code> tartalmazza a futamokat, pilótákat és átlagos köridőket (~1000+ rekord).</p>
      </div>
      <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
        <h3 class="text-red-500 font-bold mb-2 uppercase text-sm italic">Normalizálás</h3>
        <p class="text-slate-400 text-xs">Z-Score kiszámítása: $z = \frac{x - \mu}{\sigma}$. Ez mutatja meg a pilóták konzisztenciáját a mezőnyhöz képest.</p>
      </div>
      <div class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
        <h3 class="text-red-500 font-bold mb-2 uppercase text-sm italic">Célközönség</h3>
        <p class="text-slate-400 text-xs">Középmenedzsment / Befektetők: Stratégiai döntéshozatal a versenyzői hatékonyság alapján.</p>
      </div>
    </section>
  </div>

  <script>
    const spec = {
      "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "width": "container",
      "height": 400,
      "background": "transparent",
      "data": { "url": "data.csv" },
      "transform": [
        {
          "aggregate": [{"op": "mean", "field": "LapTime_Avg", "as": "SeasonAvg"}],
          "groupby": ["Driver", "Team"]
        },
        {
          "window": [
            {"op": "mean", "field": "SeasonAvg", "as": "GlobalAvg"},
            {"op": "stdev", "field": "SeasonAvg", "as": "GlobalStd"}
          ]
        },
        {
          "calculate": "(datum.SeasonAvg - datum.GlobalAvg) / datum.GlobalStd",
          "as": "z_score"
        }
      ],
      "mark": {"type": "bar", "cornerRadiusTop": 10, "tooltip": true},
      "encoding": {
        "x": {
          "field": "Driver", 
          "type": "nominal", 
          "sort": "y", 
          "title": "Versenyző",
          "axis": {"labelAngle": -45, "labelColor": "#64748b"}
        },
        "y": {
          "field": "z_score", 
          "type": "quantitative", 
          "title": "Z-Score (Relatív Gyorsaság)",
          "axis": {"grid": true, "gridDash": [2,2]}
        },
        "color": {
          "field": "z_score",
          "type": "quantitative",
          "scale": {"scheme": "redblue", "reverse": true},
          "legend": null
        },
        "tooltip": [
          {"field": "Driver", "title": "Pilóta"},
          {"field": "Team", "title": "Csapat"},
          {"field": "z_score", "title": "Z-Score", "format": ".2f"}
        ]
      },
      "config": {
        "view": {"stroke": "transparent"},
        "axis": {"domain": false, "ticks": false}
      }
    };

    vegaEmbed('#vis', spec, {actions: false});
  </script>
</body>
</html>
